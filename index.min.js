/*
 * logger-request-cli v1.1.1
 * (c) hex7c0 http://supergiovane.tk/#/logger-request-cli
 * Licensed under GPLv3
 */
"use strict";function wrapper(a){var b=process.hrtime(),c=0,d=0,e=[],f=startline({file:a.filename,encoding:"utf8"}),g=ansi.green.open,h=ansi.green.close;return a.url&&e.push([input.url,[Object.create(null),"url"],[output.url,[g+"ROUTE","METHOD","STATUS","COUNTER",h]]]),a.ip&&e.push([input.cc,[Object.create(null),"ip"],[output.ip,[g+"IP","COUNTER"+h]]]),a.response&&e.push([input.avg,[{what:0,total:0,max:0,min:1e4},"response"],[output.avg,[g+"RESPONSE","MS"+h]]]),a.pid&&e.push([input.cc,[Object.create(null),"pid"],[output.cc,[g+"PID"+h]]]),a.bytesReq&&e.push([input.avg,[{what:0,total:0,max:0,min:1e4},"bytesReq"],[output.avg,[g+"BYTES REQUESTED","BYTE"+h]]]),a.bytesRes&&e.push([input.avg,[{what:0,total:0,max:0,min:1e4},"bytesRes"],[output.avg,[g+"BYTES SENT","BYTE"+h]]]),a.referrer&&e.push([input.cc,[Object.create(null),"referrer"],[output.cc,[g+"REFERRER"+h]]]),a.auth&&e.push([input.cc,[Object.create(null),"auth"],[output.cc,[g+"USER ATHENTICATION"+h]]]),a.agent&&e.push([input.cc,[Object.create(null),"agent"],[output.cc,[g+"USER-AGENT"+h]]]),a.version&&e.push([input.cc,[Object.create(null),"version"],[output.cc,[g+"HTTP VERSION"+h]]]),a.level&&e.push([input.cc,[Object.create(null),"level"],[output.cc,[g+"LOG LEVEL"+h]]]),a.message&&e.push([input.cc,[Object.create(null),"message"],[output.cc,[g+"LOG MESSAGE"+h]]]),a.timestamp&&e.push([input.cc,[Object.create(null),"timestamp"],[output.cc,[g+"LOG TIMESTAMP"+h]]]),a.search?(e=[],f.on("line",function(b){var d=b.match(a.search);if(d){var b=b.replace(a.search,ansi.red.open+d[0]+ansi.red.close+ansi.gray.open);e.push(["line "+c,ansi.gray.open+b+ansi.gray.close])}c++}),void f.on("close",function(){0==e.length&&console.log("Not found"),console.log(table(e))})):(f.on("line",function(a){c++;try{for(var a=JSON.parse(a),b=0,f=e.length;f>b;b++){var g=e[b][1];g[0]=e[b][0](a,g)}}catch(h){d++}}),f.on("close",function(){for(var f=[],g=[],h=0,i=e.length;i>h;h++)for(var j=e[h][2][0](e[h][1],e[h][2][1]),k=0,l=j.length;l>k;k++)f.push(j[k]);var m=f.slice();if(a.report){g.push([ansi.yellow.open+"REPORT"+ansi.yellow.close],["line parsed",ansi.underline.open+c+ansi.underline.close]),m.push(g[0]),m.push(g[1]),d>0&&(g.push([ansi.red.open+"line error",d+ansi.red.close]),m.push(g[2]));var n=process.hrtime(b);n=((1e9*n[0]+n[1])/1e6).toFixed(3)+" ms",g.push(["time elapsed",ansi.underline.open+n+ansi.underline.close]),m.push(g[g.length-1])}if(a.csv){var o=require(min+"lib/csv.js");console.log(table(g,{align:["l","r"],stringLength:function(a){return a.replace(re,"").length}})),o(String(a.csv),f)}else console.log(table(m,{align:["l","r"],stringLength:function(a){return a.replace(re,"").length}}))}),a)}var min=__dirname+"/min/",re=new RegExp("(?:\\[(?:\\d+[ABCDEFGJKSTm]|\\d+;\\d+[Hfm]|\\d+;\\d+;\\d+m|6n|s|u|\\?25[lh])|\\w)","g");try{var ansi=require("ansi-styles"),fs=require("fs"),resolve=require("path").resolve,startline=require("startline"),table=require("text-table"),input=require(min+"lib/in.js"),output=require(min+"lib/out.js")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){var a=a||Object.create(null),b={filename:resolve(String(a.filename)),ip:Boolean(a.ip),url:Boolean(a.url),response:Boolean(a.response),pid:Boolean(a.pid),bytesReq:Boolean(a.bytesReq),bytesRes:Boolean(a.bytesRes),referrer:Boolean(a.referrer),auth:Boolean(a.auth),agent:Boolean(a.agent),version:Boolean(a.version),level:Boolean(a.level),message:Boolean(a.message),timestamp:Boolean(a.timestamp),report:0==a.report?!1:!0,csv:a.csv,search:a.search};if(!fs.existsSync(b.filename)){var c=b.filename+" not exists";throw new Error(c)}return b.csv&&(b.csv=resolve(String(b.csv))),b.search&&(b.search=new RegExp(b.search,"g")),wrapper(b)};
