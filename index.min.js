/*
 * logger-request-cli v0.0.1
 * (c) hex7c0 https://github.com/hex7c0/logger-request-cli/
 * Licensed under GPLv3
 */
"use strict";function wrapper(a){var b=process.hrtime(),c=0,d=0,e=[],f=startline({file:a.filename,encoding:"utf8"});a.url&&e.push([input.url,[Object.create(null),"url"],[output.url,["ROUTE","METHOD","STATUS","COUNTER"]]]),a.ip&&e.push([input.cc,[Object.create(null),"ip"],[output.ip,["IP","COUNTER"]]]),a.response&&e.push([input.avg,[{what:0,total:0,max:0,min:1e4},"response"],[output.avg,["RESPONSE","MS"]]]),a.pid&&e.push([input.cc,[Object.create(null),"pid"],[output.cc,["PID"]]]),a.bytesReq&&e.push([input.avg,[{what:0,total:0,max:0,min:1e4},"bytesReq"],[output.avg,["BYTES REQUESTED","BYTE"]]]),a.bytesRes&&e.push([input.avg,[{what:0,total:0,max:0,min:1e4},"bytesRes"],[output.avg,["BYTES SENT","BYTE"]]]),a.referrer&&e.push([input.cc,[Object.create(null),"referrer"],[output.cc,["REFERRER"]]]),a.auth&&e.push([input.cc,[Object.create(null),"auth"],[output.cc,["USER ATHENTICATION"]]]),a.agent&&e.push([input.cc,[Object.create(null),"agent"],[output.cc,["USER-AGENT"]]]),a.version&&e.push([input.cc,[Object.create(null),"version"],[output.cc,["HTTP VERSION"]]]),a.level&&e.push([input.cc,[Object.create(null),"level"],[output.cc,["LOG LEVEL"]]]),a.message&&e.push([input.cc,[Object.create(null),"message"],[output.cc,["LOG MESSAGE"]]]),a.timestamp&&e.push([input.cc,[Object.create(null),"timestamp"],[output.cc,["LOG TIMESTAMP"]]]),f.on("line",function(a){c++;try{for(var a=JSON.parse(a),b=0,f=e.length;f>b;b++){var g=e[b][1];g[0]=e[b][0](a,g)}}catch(h){d++}}),f.on("close",function(){for(var f=[],g=0,h=e.length;h>g;g++)for(var i=e[g][2][0](e[g][1],e[g][2][1]),j=0,k=i.length;k>j;j++)f.push(i[j]);if(a.report){var l=process.hrtime(b);l=((1e9*l[0]+l[1])/1e6).toFixed(3)+" ms",f.push(["REPORT"],["line parsed",c],["line error",d],["time elapsed",l])}console.log(table(f,{align:["l","r"]}))})}try{var min=__dirname+"/min/",fs=require("fs"),startline=require("startline"),table=require("text-table"),input=require(min+"lib/in.js"),output=require(min+"lib/out.js")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){var a=a||Object.create(null),b={filename:require("path").resolve(String(a.filename||"route.log")),ip:Boolean(a.ip),url:Boolean(a.url),response:Boolean(a.response),pid:Boolean(a.pid),bytesReq:Boolean(a.bytesReq),bytesRes:Boolean(a.bytesRes),referrer:Boolean(a.referrer),auth:Boolean(a.auth),agent:Boolean(a.agent),version:Boolean(a.version),level:Boolean(a.level),message:Boolean(a.message),timestamp:Boolean(a.timestamp),report:!Boolean(a.report)};if(!fs.existsSync(b.filename)){var c=b.filename+" not exists";throw new Error(c)}return wrapper(b)};
